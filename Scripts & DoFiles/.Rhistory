#### Readme ----
#Este script de R lee bases de datos txt, unifica bases, limpia duplicados y
#exporta la base final en formato .xlsx
#### Librerias ----
library(readxl) #Lectura de bases de datos (Excel)
library(tidyr) #Limpieza manipulación y transformación de datos
library(dplyr) #Manipulación de datos con sintaxis intuitiva
library(writexl) #Guardar excel write_xlsx
library(stringi) #strings
library(stringr) #strings
library(data.table) #Manejo de dataframes
library(openxlsx)
library(RColorBrewer) #Paleta de colores
library(ggplot2) #Graficos
library(wordcloud2) #Nubes de palabras
library(haven) #Leer y escribir bases en dta
####Ruta de bases de datos----
Dir_dane<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Directorio_DANE.txt"
Export<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Exportaciones.txt"
RUES_r<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/RUES.txt"
supSos<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Supersociedades.txt"
emp_dane<-read.table(Dir_dane, header=T,sep="|",dec="," ) #Cargue de base de datos del directorio del DANE
export<-read.table(Export, header=T,sep="|",dec="," )     #Cargue de base de datos de exportaciones
RUES<-read.table(RUES_r, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de RUES
ssoc<-read.table(supSos, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de super sociedades
#### Selección de empresas -----
r_probit<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Master_Probit_Logit.dta"
final<-read_dta(r_probit)
table(export$Sector..ult.10.años)
Sec_more_freq<-data.frame(table(export$Sector..ult.10.años))
colnames(Sec_more_freq)<-c("Sector", "Frecuencia")
View(Sec_more_freq)
#Viendo los principales subsectores a los que pertenecen las empresas exportadoras
Subsec_more_freq<-data.frame(table(export$Subsector..ult.10.años))
colnames(Subsec_more_freq)<-c("Subsector", "Frecuencia")
View(Subsec_more_freq)
#Seleccionando empresas
colnames(final)
#Seleccionando empresas
df2<-final[,c("NIT","exportadora","plogit","pprobit","Sectorult10años","Subsectorult10años")]
View(df2)
df3<-subset(df2, exportadora==0)
View(df3)
table(export$CIIU.Rev.4.principal)
#Cargue de base de datos CIIU para identificar el sector (División, Grupo y Clase de las empresas)
r_CIIU<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/MASTER CIIU por sectores.xlsx"
CIIU<-read_excel(r_CIIU, sheet="Master")
View(CIIU)
#Pegandole la CIIU a la base de exportaciones y a la base final
final$CIIURev4principal
#Pegandole la CIIU a la base de exportaciones y a la base final
export2<-merge(export, CIIU, by.x="CIIU.Rev.4.principal", by.y="CLASE", all.x=T)
View(export2)
final2<-merge(final,CIIU, by.x="CIIURev4principal", by.y="CLASE", all.x=T)
#Viendo los principales sectores a los que pertenecen las empresas exportadoras
division_more_freq<-data.frame(table(export2$`DESCRIPCIÓN DIVISIÓN`))
colnames(division_more_freq)<-c("division", "Frecuencia")
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Subsector", "Frecuencia")
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
View(division_more_freq)
View(grupo_more_freq)
View(clase_more_freq)
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
View(df2)
df3<-subset(df2, exportadora==0)
View(df3)
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","CIIURev4principal","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
View(df3)
CIIU<-read_excel(r_CIIU, sheet="Master_valores")
CIIU<-read_excel(r_CIIU, sheet="Master_valores")
#Pegandole la CIIU a la base de exportaciones y a la base final
export2<-merge(export, CIIU, by.x="CIIU.Rev.4.principal", by.y="CLASE", all.x=T)
final2<-merge(final,CIIU, by.x="CIIURev4principal", by.y="CLASE", all.x=T)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
division_more_freq<-data.frame(table(export2$`DESCRIPCIÓN DIVISIÓN`))
colnames(division_more_freq)<-c("division", "Frecuencia")
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
final2$CIIURev4principal
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","CIIURev4principal","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
View(df3)
View(division_more_freq)
View(grupo_more_freq)
View(clase_more_freq)
View(df2)
View(df2)
View(clase_more_freq)
View(export2)
View(CIIU)
#Pegandole la CIIU a la base de exportaciones y a la base final
export2<-merge(export, CIIU, by.x="CIIU.Rev.4.principal", by.y="CLASE", all.x=T)
final2<-merge(final,CIIU, by.x="CIIURev4principal", by.y="CLASE", all.x=T)
View(export2)
View(CIIU)
CIIU<-read_excel(r_CIIU, sheet="Master_valores")
#Pegandole la CIIU a la base de exportaciones y a la base final
export2<-merge(export, CIIU, by.x="CIIU.Rev.4.principal", by.y="CLASE2", all.x=T)
View(export2)
final2<-merge(final,CIIU, by.x="CIIURev4principal", by.y="CLASE2", all.x=T)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
division_more_freq<-data.frame(table(export2$`DESCRIPCIÓN DIVISIÓN`))
colnames(division_more_freq)<-c("division", "Frecuencia")
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
final2$CIIURev4principal
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","CIIURev4principal","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
View(df3)
table(export$CIIU.Rev.4.principal[nchar(export$CIIU.Rev.4.principal)==3])
View(CIIU)
export2$CIIU<-ifelse(nchar(export2$CIIU.Rev.4.principal)==3, paste(0,export2$CIIU.Rev.4.principal),export2$CIIU.Rev.4.principal)
export2<-merge(export, CIIU, by.x="CIIU.Rev.4.principal", by.y="CLASE2", all.x=T)
export2<-merge(export, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
export2<-merge(export2, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
View(CIIU)
#Pegandole la CIIU a la base de exportaciones y a la base final
#En las bases que enviaron hay algunos CIIU a nivel clase que tienen 3 dígitos, poniendoles 0 al principio para que cruce
export2$CIIU<-ifelse(nchar(export2$CIIU.Rev.4.principal)==3, paste(0,export2$CIIU.Rev.4.principal),export2$CIIU.Rev.4.principal)
export2<-merge(export2, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Lo mismo para base final
final2$CIIU<-ifelse(nchar(final2$CIIURev4principal)==3, paste(0,final2$CIIURev4principal),final2$CIIURev4principal)
final2<-merge(final2,CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#### Readme ----
#Este script de R lee bases de datos txt, unifica bases, limpia duplicados y
#exporta la base final en formato .xlsx
#### Librerias ----
library(readxl) #Lectura de bases de datos (Excel)
library(tidyr) #Limpieza manipulación y transformación de datos
library(dplyr) #Manipulación de datos con sintaxis intuitiva
library(writexl) #Guardar excel write_xlsx
library(stringi) #strings
library(stringr) #strings
library(data.table) #Manejo de dataframes
library(openxlsx)
library(RColorBrewer) #Paleta de colores
library(ggplot2) #Graficos
library(wordcloud2) #Nubes de palabras
library(haven) #Leer y escribir bases en dta
####Ruta de bases de datos----
Dir_dane<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Directorio_DANE.txt"
Export<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Exportaciones.txt"
RUES_r<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/RUES.txt"
supSos<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Supersociedades.txt"
emp_dane<-read.table(Dir_dane, header=T,sep="|",dec="," ) #Cargue de base de datos del directorio del DANE
export<-read.table(Export, header=T,sep="|",dec="," )     #Cargue de base de datos de exportaciones
RUES<-read.table(RUES_r, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de RUES
ssoc<-read.table(supSos, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de super sociedades
#### Selección de empresas -----
r_probit<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Master_Probit_Logit.dta"
final<-read_dta(r_probit)
#Cargue de base de datos CIIU para identificar el sector (División, Grupo y Clase de las empresas)
r_CIIU<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/MASTER CIIU por sectores.xlsx"
CIIU<-read_excel(r_CIIU, sheet="Master_valores")
#Pegandole la CIIU a la base de exportaciones y a la base final
#En las bases que enviaron hay algunos CIIU a nivel clase que tienen 3 dígitos, poniendoles 0 al principio para que cruce
export$CIIU<-ifelse(nchar(export$CIIU.Rev.4.principal)==3, paste(0,export$CIIU.Rev.4.principal),export$CIIU.Rev.4.principal)
export2<-merge(export, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Lo mismo para base final
final$CIIU<-ifelse(nchar(final$CIIURev4principal)==3, paste(0,final$CIIURev4principal),final$CIIURev4principal)
final2<-merge(final,CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
division_more_freq<-data.frame(table(export2$`DESCRIPCIÓN DIVISIÓN`))
colnames(division_more_freq)<-c("division", "Frecuencia")
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
final2$CIIURev4principal
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
View(df3)
#Pegandole la CIIU a la base de exportaciones y a la base final
#En las bases que enviaron hay algunos CIIU a nivel clase que tienen 3 dígitos, poniendoles 0 al principio para que cruce
export$CIIU<-ifelse(nchar(export$CIIU.Rev.4.principal)==3, paste(0,export$CIIU.Rev.4.principal, sep=""),export$CIIU.Rev.4.principal)
export2<-merge(export, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Lo mismo para base final
final$CIIU<-ifelse(nchar(final$CIIURev4principal)==3, paste(0,final$CIIURev4principal, sep=""),final$CIIURev4principal)
final2<-merge(final,CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
division_more_freq<-data.frame(table(export2$`DESCRIPCIÓN DIVISIÓN`))
colnames(division_more_freq)<-c("division", "Frecuencia")
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
View(df3)
df4<-subset(df3, pprobit>0.5)
View(df4)
df4<-subset(df3, plogit>0.5)
df5<-subset(df3,CIIU="0141")
View(df5)
df5<-subset(df3,CIIU=="0141")
df5<-subset(df3,CIIU=="0141" & pprobit>0.22935623)
df4<-subset(df3, plogit>0.5) #Empresas con una probabilidad mayor a 0.5 a exportar
View(df4)
View(df3)
df6<-rebind(df4,df5)
df6<-rbind(df4,df5)
View(df6)
seleccionadas<-df6$NIT
final_2_vice<-final2[final2$NIT %in% seleccionadas, ]
View(final_2_vice)
View(clase_more_freq)
View(division_more_freq)
#Exportación de base de datos para seleccionar empresas
r_seleccion<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/Empresas_seleccionadas.xlsx"
write_xlsx(final_2_vice,r_seleccion)
df5<-subset(df3,CIIU=="1011")
View(df5)
df5<-subset(df3,CIIU=="1011" & (TamañoempresaRUES=="Grande" | TamañoempresaRUES=="Mediana") )
View(df5)
df6<-rbind(df4,df5)
seleccionadas<-df6$NIT
final_2_vice<-final2[final2$NIT %in% seleccionadas, ]
write_xlsx(final_2_vice,r_seleccion)
df7<-subset(df3, exportadora==1)
View(df7)
df7<-subset(df2, exportadora==1)
View(df7)
df7<-final2[,c("NIT","exportadora","plogit","pprobit","Expopromult5años","Expo2022","VarExpo2022","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df8<-subset(df7,Expo2022==0 )
View(df8)
table(df8$TamañoempresaRUES)
df9<-subset(df8, CIIU=="1011")
View(df9)
View(df8)
df9<-subset(df8, plogit>0.5)
View(df9)
mean(df9$Expopromult5años)
mean(df8$Expopromult5años)
df10<-subset(df8, Expopromult5años>mean(df8$Expopromult5años))
View(df10)
View(df10)
df6$Type<-"No Exportadora"
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","Expopromult5años","Expo2022","VarExpo2022","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
df4<-subset(df3, plogit>0.5) #Empresas con una probabilidad mayor a 0.5 a exportar
df5<-subset(df3,CIIU=="1011" & (TamañoempresaRUES=="Grande" | TamañoempresaRUES=="Mediana") )
df6<-rbind(df4,df5)
df6$Type<-"No Exportadora"
df7<-final2[,c("NIT","exportadora","plogit","pprobit","Expopromult5años","Expo2022","VarExpo2022","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df8<-subset(df7,Expo2022==0 )
df9<-subset(df8, plogit>0.5)
df10<-subset(df8, Expopromult5años>mean(df8$Expopromult5años))
df10$Type<-"Exportadora"
df11<-rbind(df10,df6)
seleccionadas<-df11$NIT
final_2_vice<-final2[final2$NIT %in% seleccionadas, ]
#Exportación de base de datos para seleccionar empresas
r_seleccion<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/Empresas_seleccionadas.xlsx"
write_xlsx(final_2_vice,r_seleccion)
#### Librerias ----
library(readxl) #Lectura de bases de datos (Excel)
library(tidyr) #Limpieza manipulación y transformación de datos
library(dplyr) #Manipulación de datos con sintaxis intuitiva
library(writexl) #Guardar excel write_xlsx
library(stringi) #strings
library(stringr) #strings
library(data.table) #Manejo de dataframes
library(openxlsx)
library(RColorBrewer) #Paleta de colores
library(ggplot2) #Graficos
library(wordcloud2) #Nubes de palabras
library(haven) #Leer y escribir bases
write_xlsx(final_2_vice,r_seleccion)
View(final_2_vice)
colnames(final_2_vice)
View(df11)
colnames(df11)
final_2_vice<-merge(final_2_vice, df11[,c"NIT","Type"], by=="NIT", all.x=T)
final_2_vice<-merge(final_2_vice, df11[,c("NIT","Type")], by=="NIT", all.x=T)
final_2_vice<-merge(final_2_vice, df11[,c("NIT","Type")], by.x=="NIT",by.y=="NIT", all.x=T)
df11[,c("NIT","Type")]
final_2_vice2<-merge(final_2_vice, df11[,c("NIT","Type")], by.x=="NIT",by.y=="NIT", all.x=T)
final_2_vice2<-merge(final_2_vice, df11[,c("NIT","Type")], by="NIT", all.x=T)
final_2_vice<-merge(final_2_vice, df11[,c("NIT","Type")], by="NIT", all.x=T)
#Exportación de base de datos para seleccionar empresas
r_seleccion<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/Empresas_seleccionadas.xlsx"
write_xlsx(final_2_vice,r_seleccion)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
seccion_more_freq<-data.frame(table(export2$`DESCRIPCIÓN SECCIÓN`))
colnames(seccion_more_freq)<-c("Sección", "Frecuencia")
View(seccion_more_freq)
sum(seccion_more_freq$Frecuencia)
seccion_more_freq$Freq_rela<-seccion_more_freq$Frecuencia/sum(seccion_more_freq)
sum(seccion_more_freq)
seccion_more_freq$Freq_rela<-seccion_more_freq$Frecuencia/sum(seccion_more_freq$Frecuencia)
View(seccion_more_freq)
0.47+0.29+0.06
#### Librerias ----
library(readxl) #Lectura de bases de datos (Excel)
library(tidyr) #Limpieza manipulación y transformación de datos
library(dplyr) #Manipulación de datos con sintaxis intuitiva
library(writexl) #Guardar excel write_xlsx
library(stringi) #strings
library(stringr) #strings
library(data.table) #Manejo de dataframes
library(openxlsx)
library(RColorBrewer) #Paleta de colores
library(ggplot2) #Graficos
library(wordcloud2) #Nubes de palabras
library(haven) #Leer y escribir bases en dta
####Ruta de bases de datos----
Dir_dane<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Directorio_DANE.txt"
Export<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Exportaciones.txt"
RUES_r<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/RUES.txt"
supSos<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Supersociedades.txt"
emp_dane<-read.table(Dir_dane, header=T,sep="|",dec="," ) #Cargue de base de datos del directorio del DANE
export<-read.table(Export, header=T,sep="|",dec="," )     #Cargue de base de datos de exportaciones
RUES<-read.table(RUES_r, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de RUES
ssoc<-read.table(supSos, header=T,sep="|",dec="," )       #Cargue de base de datos de listado de super sociedades
#### Pegue de bases de datos ----
#Identificar si las bases tienen las mismas variables
identical(colnames(emp_dane), colnames(RUES)) #Las variables de emp_dane y RUES son las mismas
identical(colnames(RUES), colnames(export))  #Las variables de RUES son las mismas de export
identical(colnames(export), colnames(ssoc))  #Las variables de export son las mismas que ssoc
#Dado que las bases tienen las mismas variables se hace un rbind (pegar y una base debajo de la otra)
Master<-rbind(emp_dane,export,RUES,ssoc)
# ya que hay empresas que pueden estar en más de una base, se limpian los duplicados por NIT
Master2<- Master %>% distinct(NIT, .keep_all = T)
#### Parte 2 / Selección de empresas  -----
r_probit<-"D:/OneDrive/Escritorio/ProColombia/Datos-20231216T185808Z-001/Datos/Master_Probit_Logit.dta"
final<-read_dta(r_probit)
#Cargue de base de datos CIIU para identificar el sector (División, Grupo y Clase de las empresas)
r_CIIU<-"D:/OneDrive - Universidad Externado de Colombia/Test_ProCol/Datos-20231216T185808Z-001/Datos/MASTER CIIU por sectores.xlsx"
CIIU<-read_excel(r_CIIU, sheet="Master_valores")
#Pegandole la CIIU a la base de exportaciones y a la base final
#En las bases que enviaron hay algunos CIIU a nivel clase que tienen 3 dígitos, poniéndoles 0 al principio para que cruce
#la funcion "ifelse" me permite transformar observaciones. La función nchar me permite identificar el número de caracteres de una variable
#La función "paste" me permite pegar variables o numeros y variables, con un separador.
#La línea 61 le pone un 0 a las observaciones de la variable "CIIU.Rev.4.principal" al principio cuando tiene 3 digitos y cuando no, la deja igual
export$CIIU<-ifelse(nchar(export$CIIU.Rev.4.principal)==3, paste(0,export$CIIU.Rev.4.principal, sep=""),export$CIIU.Rev.4.principal)
export2<-merge(export, CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Lo mismo para base final
final$CIIU<-ifelse(nchar(final$CIIURev4principal)==3, paste(0,final$CIIURev4principal, sep=""),final$CIIURev4principal)
final2<-merge(final,CIIU, by.x="CIIU", by.y="CLASE2", all.x=T)
#Viendo las principales divisiones a las que pertenecen las empresas exportadoras
seccion_more_freq<-data.frame(table(export2$`DESCRIPCIÓN SECCIÓN`))
colnames(seccion_more_freq)<-c("Sección", "Frecuencia")
seccion_more_freq$Freq_rela<-seccion_more_freq$Frecuencia/sum(seccion_more_freq$Frecuencia)
#Viendo los principales grupos a los que pertenecen las empresas exportadoras
grupo_more_freq<-data.frame(table(export2$`DESCRIPCIÓN GRUPO`))
colnames(grupo_more_freq)<-c("Grupo", "Frecuencia")
#Viendo las principales clases a las que pertenecen las empresas exportadoras
clase_more_freq<-data.frame(table(export2$`DESCRIPCIÓN CLASE`))
colnames(clase_more_freq)<-c("Clase","Frecuencia")
#Seleccionando empresas
df2<-final2[,c("NIT","exportadora","plogit","pprobit","Expopromult5años","Expo2022","VarExpo2022","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df3<-subset(df2, exportadora==0)
df4<-subset(df3, plogit>0.5) #Empresas con una probabilidad mayor a 0.5 a exportar
df5<-subset(df3,CIIU=="1011" & (TamañoempresaRUES=="Grande" | TamañoempresaRUES=="Mediana") ) #Empresas del CIIU 1011 medianas o grandes
df6<-rbind(df4,df5)
df6$Type<-"No Exportadora"
df7<-final2[,c("NIT","exportadora","plogit","pprobit","Expopromult5años","Expo2022","VarExpo2022","CIIU","DESCRIPCIÓN DIVISIÓN","DESCRIPCIÓN GRUPO","DESCRIPCIÓN CLASE","TamañoempresaRUES")]
df8<-subset(df7,Expo2022==0 )
df9<-subset(df8, plogit>0.5)
df10<-subset(df8, Expopromult5años>mean(df8$Expopromult5años))
df10$Type<-"Exportadora"
df11<-rbind(df10,df6)
seleccionadas<-df11$NIT
final_2_vice<-final2[final2$NIT %in% seleccionadas, ]
final_2_vice<-merge(final_2_vice, df11[,c("NIT","Type")], by="NIT", all.x=T)
